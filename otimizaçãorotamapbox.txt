Relatório Técnico: Mapbox Optimization
API
Autor: Manus AI
Data: 18 de janeiro de 2026
Versão da API: v2 (Beta) e v1 (Estável)
1. Visão Geral
A Mapbox Optimization API resolve o clássico Problema do Caixeiro Viajante (TSP -
Traveling Salesman Problem), determinando a sequência mais eficiente para visitar
múltiplos pontos. É essencial para qualquer sistema de logística, entrega ou
roteirização que necessite minimizar tempo de viagem, distância ou custos
operacionais.
Problema Resolvido
Dado um conjunto de paradas (pontos de entrega, coleta, visitação), a API calcula a
ordem ideal para visitá-las, minimizando:
Tempo total de viagem
Distância total percorrida
Custos operacionais (combustível, manutenção)
Tempo de espera em congestionamentos
Aplicações Práticas
Serviços de Entrega: Otimizar rotas de entregadores
Logística: Planejamento de rotas para frotas
Táxi/Ride-sharing: Sequenciar paradas de passageiros
Serviços de Campo: Agendamento de visitas técnicas
Turismo: Planejamento de roteiros turísticos
Coleta de Resíduos: Otimizar rotas de coleta
2. Versões da API
2.1 Optimization API v2 (Beta)
Status: Beta - Recomendado para novos projetos
Endpoint: POST https://api.mapbox.com/optimized-trips/v2
Vantagens:
Suporta até 100 paradas (vs 12 na v1)
Múltiplos veículos
Janelas de tempo por parada
Restrições de capacidade
Processamento assíncrono
Melhor performance para problemas complexos
Desvantagens:
API em beta (pode sofrer mudanças)
Requer polling para obter resultados
Mais complexa de implementar
2.2 Optimization API v1 (Estável)
Status: Estável e em produção
Endpoint: GET https://api.mapbox.com/optimizedtrips/v1/{profile}/{coordinates}
Vantagens:
API estável e confiável
Simples de usar (GET request)
Resposta imediata
Bem documentada
Desvantagens:
Máximo de 12 paradas
Um único veículo
Sem suporte a janelas de tempo complexas
Sem restrições de capacidade
3. Optimization API v1 (Estável)
3.1 Endpoint e Autenticação
URL Base:
GET https://api.mapbox.com/optimized-trips/v1/{profile}/{coordinates}
Perfis Disponíveis:
Perfil Descrição Uso
mapbox/driving Roteamento automotivo padrão Entregas, logística geral
mapbox/driving-traffic Com tráfego em tempo real Entregas em horários de pico
mapbox/walking Roteamento para pedestres Entregas a pé, serviços locais
mapbox/cycling Roteamento para bicicletas Entregas por bicicleta
Autenticação:
?access_token=YOUR_MAPBOX_ACCESS_TOKEN
3.2 Formato de Coordenadas
As coordenadas devem ser fornecidas como uma sequência separada por ponto-evírgula:
{longitude1},{latitude1};{longitude2},{latitude2};{longitude3},{latitude3}
Exemplo:
-46.6561,-23.5505;-46.6700,-23.5600;-46.6400,-23.5400
3.3 Parâmetros de Query
Parâmetro Tipo Obrigatório Descrição
profile string Sim Perfil de roteamento
coordinates string Sim Coordenadas separadas por ponto-e-vírgula
access_token string Sim Token de autenticação
approaches string Não Direção de aproximação para cada parada
waypoint_names string Não Nomes para as paradas
annotations string Não Dados adicionais (distance, duration, speed)
language string Não Idioma das instruções
overview string Não Nível de detalhe (full, simplified, false)
geometries string Não
Formato da geometria (geojson, polyline,
polyline6)
steps boolean Não Incluir instruções passo a passo
continue_straight boolean Não Forçar continuação em linha reta
waypoint_targets string Não Coordenadas alvo para cada parada
exclude string Não Excluir tipos de estrada
3.4 Exemplo de Requisição - v1
Requisição:
curl -X GET \
'https://api.mapbox.com/optimizedtrips/v1/mapbox/driving/-46.6561,-23.5505;-46.6700,-23.5600;-46.6400,-23.5400?
access_token=YOUR_TOKEN'
Resposta (JSON):
{
"code": "Ok",
"waypoints": [
{
"hint": "...",
"distance": 0,
"name": "Parada 1",
"location": [-46.6561, -23.5505]
},
{
"hint": "...",
"distance": 150,
"name": "Parada 2",
"location": [-46.6700, -23.5600]
},
{
"hint": "...",
"distance": 200,
"name": "Parada 3",
"location": [-46.6400, -23.5400]
}
],
"trips": [
{
"legs": [
{
"distance": 1500,
"duration": 300,
"steps": [],
"summary": "",
"weight": 300,
"weight_name": "duration"
},
{
"distance": 2000,
"duration": 450,
"steps": [],
"summary": "",
"weight": 450,
"weight_name": "duration"
}
],
"distance": 3500,
"duration": 750,
"weight": 750,
"weight_name": "duration",
"geometry": "...",
"waypoint_indices": [0, 1, 2]
}
]
}
3.5 Interpretando a Resposta v1
Campo Descrição
code Status da requisição (Ok, NoRoute, NoMatch, etc.)
waypoints Array com informações de cada parada
waypoints[].location Coordenadas [lon, lat]
waypoints[].distance Distância até a parada anterior (metros)
trips[0].waypoint_indices Ordem otimizada das paradas
trips[0].distance Distância total da rota (metros)
trips[0].duration Duração total da rota (segundos)
trips[0].legs Detalhes de cada trecho entre paradas
legs[].distance Distância do trecho (metros)
legs[].duration Duração do trecho (segundos)
4. Optimization API v2 (Beta)
4.1 Endpoint e Autenticação
URL Base:
POST https://api.mapbox.com/optimized-trips/v2
Autenticação:
Authorization: Bearer YOUR_MAPBOX_ACCESS_TOKEN
4.2 Corpo da Requisição (JSON)
{
"locations": [
{
"id": "warehouse",
"coordinates": [-46.6561, -23.5505]
},
{
"id": "delivery_1",
"coordinates": [-46.6700, -23.5600],
"time_window": [1000, 2000]
},
{
"id": "delivery_2",
"coordinates": [-46.6400, -23.5400],
"time_window": [1500, 2500]
}
],
"vehicles": [
{
"id": "vehicle_1",
"start_location": "warehouse",
"end_location": "warehouse",
"capacity": 10,
"profile": "mapbox/driving"
}
],
"options": {
"language": "pt",
"overview": "full",
"geometries": "geojson"
}
}
4.3 Parâmetros da Requisição v2
Locations (Paradas)
Campo Tipo Obrigatório Descrição
id string Sim Identificador único da parada
coordinates array Sim [longitude, latitude]
time_window array Não [início, fim] em segundos (janela de tempo)
service_time number Não Tempo de serviço em segundos
demand array Não Demanda de capacidade
priority number Não Prioridade da parada (0-10)
Vehicles (Veículos)
Campo Tipo Obrigatório Descrição
id string Sim Identificador único do veículo
start_location string Sim ID da localização inicial
end_location string Não ID da localização final (padrão: start)
capacity array Não Capacidade do veículo
profile string Não Perfil de roteamento
speed_factor number Não Fator de velocidade (0.5-2.0)
max_distance number Não Distância máxima em metros
max_duration number Não Duração máxima em segundos
4.4 Fluxo de Requisição Assíncrona v2
Passo 1: Enviar Requisição
curl -X POST \
'https://api.mapbox.com/optimized-trips/v2' \
-H 'Authorization: Bearer YOUR_TOKEN' \
-H 'Content-Type: application/json' \
-d '{ ... corpo da requisição ... }'
Resposta Inicial:
{
"id": "request_id_12345",
"status": "processing"
}
Passo 2: Fazer Polling
curl -X GET \
'https://api.mapbox.com/optimized-trips/v2/request_id_12345' \
-H 'Authorization: Bearer YOUR_TOKEN'
Resposta Quando Pronto:
{
"id": "request_id_12345",
"status": "success",
"solution": {
"routes": [
{
"vehicle_id": "vehicle_1",
"waypoints": [0, 1, 2],
"distance": 3500,
"duration": 750,
"geometry": "..."
}
],
"unrouted": [],
"statistics": {
"duration": 750,
"distance": 3500,
"service": 120,
"wait": 0
}
}
}
4.5 Exemplo Completo v2
Requisição:
{
"locations": [
{
"id": "warehouse",
"coordinates": [-46.6561, -23.5505]
},
{
"id": "cliente_1",
"coordinates": [-46.6700, -23.5600],
"time_window": [28800, 32400],
"service_time": 600
},
{
"id": "cliente_2",
"coordinates": [-46.6400, -23.5400],
"time_window": [32400, 36000],
"service_time": 600
},
{
"id": "cliente_3",
"coordinates": [-46.6500, -23.5550],
"time_window": [36000, 39600],
"service_time": 600
}
],
"vehicles": [
{
"id": "entregador_1",
"start_location": "warehouse",
"end_location": "warehouse",
"capacity": [50],
"profile": "mapbox/driving-traffic",
"max_duration": 28800
}
],
"options": {
"language": "pt",
"overview": "full",
"geometries": "geojson"
}
}
5. Limites e Restrições
Limites Técnicos
Aspecto v1 v2
Máximo de paradas 12 100
Máximo de veículos 1 10
Coordenadas por requisição 12 100
Timeout 30s 60s
Rate limit 300 req/min 300 req/min
Limites de Taxa
Plano Requisições/Minuto Requisições/Mês
Free 300 100.000
Pay-as-you-go 300 Ilimitado
Enterprise Customizado Customizado
Preços
Primeiras 100.000 requisições/mês: Gratuito
Requisições adicionais: $0,50 por 1.000 requisições
6. Otimizações de Performance
6.1 Estratégias para Melhorar Velocidade
1. Usar Perfil Correto
// Mais rápido para grandes distâncias
const profile = 'mapbox/driving';
// Mais preciso com tráfego em tempo real
const profile = 'mapbox/driving-traffic';
2. Limitar Número de Paradas
// v1: Máximo 12 paradas
// Se tiver mais, dividir em múltiplas requisições
const chunks = chunkArray(addresses, 12);
const optimizedChunks = await Promise.all(
chunks.map(chunk => optimizeRoute(chunk))
);
3. Usar Coordenadas Precisas
// ✅ Bom: 6 casas decimais
const coord = [-46.656123, -23.550456];
// ❌ Ruim: Muitas casas decimais (aumenta tamanho da requisição)
const coord = [-46.6561234567890, -23.5504567890123];
4. Cache de Resultados
const routeCache = new Map();
async function optimizeRouteWithCache(addresses) {
const key = JSON.stringify(addresses);
if (routeCache.has(key)) {
return routeCache.get(key);
}
const result = await optimizeRoute(addresses);
routeCache.set(key, result);
return result;
}
5. Processamento em Lote (v2)
// Enviar múltiplas requisições em paralelo
const results = await Promise.all([
optimizeRoute(batch1),
optimizeRoute(batch2),
optimizeRoute(batch3)
]);
6.2 Benchmarks de Performance
Cenário Tempo Médio Paradas
Rota simples 200ms 3-5
Rota média 500ms 6-10
Rota complexa 1-2s 11-12 (v1)
Rota grande (v2) 5-10s 50-100
7. Implementação em JavaScript/React
7.1 Função Básica v1
async function optimizeRoute(coordinates) {
const token = 'YOUR_MAPBOX_TOKEN';
const coordString = coordinates
.map(c => `${c[0]},${c[1]}`)
.join(';');
const url = `https://api.mapbox.com/optimizedtrips/v1/mapbox/driving/${coordString}?access_token=${token}`;
try {
const response = await fetch(url);
const data = await response.json();
if (data.code !== 'Ok') {
throw new Error(`Erro na otimização: ${data.code}`);
}
return {
waypoints: data.waypoints,
distance: data.trips[0].distance,
duration: data.trips[0].duration,
order: data.trips[0].waypoint_indices,
geometry: data.trips[0].geometry
};
} catch (error) {
console.error('Erro ao otimizar rota:', error);
throw error;
}
}
7.2 Hook React para Otimização
import { useState, useCallback } from 'react';
function useRouteOptimization() {
const [loading, setLoading] = useState(false);
const [error, setError] = useState(null);
const [optimizedRoute, setOptimizedRoute] = useState(null);
const optimize = useCallback(async (addresses) => {
setLoading(true);
setError(null);
try {
const coordinates = addresses.map(addr => addr.center);
const result = await optimizeRoute(coordinates);
// Reordenar endereços conforme otimização
const orderedAddresses = result.order.map(idx => addresses[idx]);
setOptimizedRoute({
addresses: orderedAddresses,
distance: result.distance,
duration: result.duration,
geometry: result.geometry
});
} catch (err) {
setError(err.message);
} finally {
setLoading(false);
}
}, []);
return { optimize, loading, error, optimizedRoute };
}
7.3 Uso em Componente
function RouteOptimizer({ addresses }) {
const { optimize, loading, optimizedRoute } = useRouteOptimization();
const handleOptimize = async () => {
await optimize(addresses);
};
return (
<div>
<button onClick={handleOptimize} disabled={loading}>
{loading ? 'Otimizando...' : 'Otimizar Rota'}
</button>
{optimizedRoute && (
<div>
<h3>Rota Otimizada</h3>
<p>Distância: {(optimizedRoute.distance / 1000).toFixed(2)} km</p>
<p>Duração: {Math.round(optimizedRoute.duration / 60)} minutos</p>
<ol>
{optimizedRoute.addresses.map((addr, idx) => (
<li key={idx}>{addr.place_name}</li>
))}
</ol>
</div>
)}
</div>
);
}
8. Casos de Uso Avançados
8.1 Sistema de Entrega Multi-Veículo (v2)
async function optimizeMultiVehicleDelivery(deliveries, vehicles) {
const locations = [
{ id: 'warehouse', coordinates: warehouseCoords },
...deliveries.map((d, i) => ({
id: `delivery_${i}`,
coordinates: d.coordinates,
time_window: [d.startTime, d.endTime],
service_time: 600
}))
];
const vehicleConfigs = vehicles.map((v, i) => ({
id: `vehicle_${i}`,
start_location: 'warehouse',
end_location: 'warehouse',
capacity: [v.capacity],
profile: 'mapbox/driving-traffic',
max_duration: 28800
}));
const response = await fetch('https://api.mapbox.com/optimized-trips/v2',
{
method: 'POST',
headers: {
'Authorization': `Bearer ${token}`,
'Content-Type': 'application/json'
},
body: JSON.stringify({
locations,
vehicles: vehicleConfigs,
options: { language: 'pt', overview: 'full' }
})
});
const result = await response.json();
return result.solution.routes;
}
8.2 Otimização com Restrições de Tempo
async function optimizeWithTimeWindows(deliveries) {
const now = Math.floor(Date.now() / 1000);
const locations = deliveries.map((d, i) => ({
id: `delivery_${i}`,
coordinates: d.coordinates,
time_window: [
now + d.earliestMinutes * 60,
now + d.latestMinutes * 60
],
service_time: d.serviceTimeSeconds
}));
// Usar v2 para suporte a time windows
const response = await fetch('https://api.mapbox.com/optimized-trips/v2',
{
method: 'POST',
headers: {
'Authorization': `Bearer ${token}`,
'Content-Type': 'application/json'
},
body: JSON.stringify({
locations,
vehicles: [{ id: 'vehicle_1', start_location: 'warehouse' }],
options: { language: 'pt' }
})
});
return await response.json();
}
9. Tratamento de Erros
Códigos de Erro Comuns
Código Significado Solução
Ok Sucesso Nenhuma ação necessária
NoRoute Sem rota possível Verificar coordenadas
NoMatch Coordenadas inválidas Validar latitude/longitude
InvalidInput Entrada inválida Revisar parâmetros
UNAUTHORIZED Token inválido Verificar token
RATE_LIMIT_EXCEEDED Limite de taxa excedido Implementar retry com backoff
Implementação de Retry com Backoff
async function optimizeRouteWithRetry(coordinates, maxRetries = 3) {
for (let attempt = 0; attempt < maxRetries; attempt++) {
try {
return await optimizeRoute(coordinates);
} catch (error) {
if (attempt === maxRetries - 1) throw error;
const delay = Math.pow(2, attempt) * 1000; // Exponential backoff
await new Promise(resolve => setTimeout(resolve, delay));
}
}
}
10. Boas Práticas
1. Sempre Validar Coordenadas
function isValidCoordinate(coord) {
const [lon, lat] = coord;
return lon >= -180 && lon <= 180 && lat >= -90 && lat <= 90;
}
2. Implementar Debounce para Requisições
const debouncedOptimize = debounce(optimize, 500);
3. Usar Perfil Apropriado
// Para entregas urbanas
const profile = 'mapbox/driving';
// Para entregas em horários de pico
const profile = 'mapbox/driving-traffic';
4. Monitorar Performance
const startTime = performance.now();
const result = await optimizeRoute(coordinates);
const duration = performance.now() - startTime;
console.log(`Otimização levou ${duration}ms`);
5. Implementar Fallback
async function optimizeWithFallback(coordinates) {
try {
return await optimizeRoute(coordinates);
} catch (error) {
console.warn('Otimização falhou, usando ordem original');
return { order: Array.from({length: coordinates.length}, (_, i) => i) };
}
}
11. Comparação v1 vs v2
Aspecto v1 v2
Paradas Até 12 Até 100
Veículos 1 Múltiplos
Time Windows Não Sim
Capacidade Não Sim
Resposta Síncrona Assíncrona
Complexidade Simples Moderada
Tempo de Resposta < 1s 5-10s
Uso Recomendado Rotas simples Logística complexa
12. Conclusão
A Mapbox Optimization API é fundamental para criar sistemas de roteirização
eficientes e escaláveis. A escolha entre v1 (simples, rápida) e v2 (complexa, poderosa)
depende dos requisitos do projeto:
Use v1 para rotas simples com até 12 paradas
Use v2 para logística complexa com múltiplos veículos e restrições
Com implementação adequada, debounce, cache e tratamento de erros, é possível
criar sistemas de otimização de rotas de nível empresarial.
13. Referências
Mapbox Optimization API Documentation
Mapbox Directions API
Mapbox Matrix API
Traveling Salesman Problem
Mapbox API Guides
Documento preparado por: Manus AI
Última atualização: 18 de janeiro de 2026
Versão: 1.0
